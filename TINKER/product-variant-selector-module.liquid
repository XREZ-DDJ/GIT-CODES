
<!-- Selector de Talla -->
<p style="font-weight: bold;">Talla</p>
<div id="kit-size" class="kit-options-group">
  {% for option in product.options_with_values[0].values %}
    <button type="button" class="kit-option-btn" data-value="{{ option }}">{{ option }}</button>
  {% endfor %}
</div>

<!-- Selector de Color -->
<p style="font-weight: bold;">Color</p>
<div id="kit-color" class="kit-options-group">
  {% for option in product.options_with_values[1].values %}
    <button type="button" class="kit-option-btn" data-value="{{ option }}">{{ option }}</button>
  {% endfor %}
</div>


<!-- Selector de Cantidad -->
<label class="size-label">
  <p class="size-name">Cantidad</p>
  <div class="quantity-wrapper">  
    <button type="button" id="quantity-increase" class="qty-btn up">‚ñ≤</button>
    <input type="number" id="kit-quantity" min="1" value="1" class="size-option">   
    <button type="button" id="quantity-decrease" class="qty-btn down">‚ñº</button>
  </div>
</label>

<!-- Bot√≥n Agregar al Carrito -->
<button id="add-to-cart-btn-kit" class="add-to-cart-btn" disabled>Agregar al carrito</button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const addToCartButton = document.getElementById("add-to-cart-btn-kit");
    const selectors = document.querySelectorAll(".kit-option-btn");
    const quantityInput = document.getElementById("kit-quantity");
    const quantityDecrease = document.getElementById("quantity-decrease");
    const quantityIncrease = document.getElementById("quantity-increase");


    const selections = {
      size: null,
      color: null,
    };

    // Funci√≥n para actualizar la selecci√≥n activa

    function updateSelection(groupId, value) {
      const group = document.getElementById(groupId);
      Array.from(group.children).forEach(button => button.classList.remove("selected"));
      const selectedButton = Array.from(group.children).find(button => button.dataset.value === value);
      if (selectedButton) selectedButton.classList.add("selected");

      // Actualizar el objeto de selecci√≥n
      if (groupId === "kit-size") selections.size = value;
      if (groupId === "kit-color") selections.color = value;

      // Habilitar el bot√≥n "Agregar al carrito" si todas las opciones est√°n seleccionadas
      const allSelected = Object.values(selections).every(selection => selection !== null);
      addToCartButton.disabled = !allSelected;
    }

    // Manejar clics en botones de opciones
    selectors.forEach(button => {
      button.addEventListener("click", function () {
        const groupId = this.parentElement.id;
        const value = this.dataset.value;
        updateSelection(groupId, value);
      });
    });

    // Manejar el incremento y decremento de la cantidad
    quantityIncrease.addEventListener("click", () => {
      quantityInput.value = parseInt(quantityInput.value, 10) + 1;
    });

    quantityDecrease.addEventListener("click", () => {
      const currentValue = parseInt(quantityInput.value, 10);
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });

    // L√≥gica para agregar la variante seleccionada al carrito

    addToCartButton.addEventListener("click", function () {
      console.log("üü¢ 'Agregar al carrito' clickeado para producto 2 opciones");

      const selectedVariant = Array.from({{ product.variants | json }}).find(variant =>
        variant.option1 === selections.size &&
        variant.option2 === selections.color
      );

      if (!selectedVariant) {
        alert("La combinaci√≥n seleccionada no est√° disponible. Intenta con otra combinaci√≥n.");
        return;
      }

      const quantity = parseInt(quantityInput.value, 10);

      // OBTENER ID DEL METACAMPO (si aplica, puedes eliminar si no hay regalo)
      // {% assign giftkit = product.metafields.custom.giftkit.value %};

      const itemsToAdd = [
        {
          id: selectedVariant.id,
          quantity: quantity,
          properties: {
            "Talla": selections.size,
            "Color": selections.color
          }
        }
      ];

      // Si necesitas agregar un regalo, descomenta y ajusta:
      // itemsToAdd.push({
      //   id: {{ giftkit.id }},
      //   quantity: quantity,
      //   properties: {}
      // });

      console.log("üõç Agregando al carrito...", itemsToAdd);

      fetch("/cart/add.js", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ items: itemsToAdd }),
      })
        .then(response => {
          if (!response.ok) throw new Error("Error al agregar al carrito");
          return response.json();
        })
        .then(resp => {
          console.log("‚úÖ Variantes agregadas con √©xito", resp);
        })
        .catch(err => {
          console.error("‚ùå Error al agregar al carrito", err);
          alert("Hubo un problema al agregar la variante. Int√©ntalo de nuevo.");
        });
    });
  });
</script>

<style>
  .kit-options-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .kit-option-btn {
    padding: 8px 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: white;
    color: black;
    cursor: pointer;
    font-size: 15px;
    transition: background-color 0.3s ease, color 0.3s ease;
    min-width: 55px;
  }

  .kit-option-btn.selected {
    background-color: red;
    color: white;
    border-color: black;
  }

  .kit-option-btn:hover:not(.selected) {
    background-color: #f0f0f0;
  }

  .size-label{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: #f5f5f5;
    border-radius: 5px;
    padding: 5px;
    width: 75px;
    color: #333;
  }
  
  .quantity-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  .size-name{
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 3px;
  }

  .qty-btn {
    width: 100%;
    height: 15px;
    background: #ddd;
    border: none;
    cursor: pointer;
    font-size: 12px;
    line-height: 12px;
    text-align: center;
  }
  .qty-btn.down{
    border-radius: 0 0 4px 4px;
  }
  .qty-btn.up{
    border-radius: 4px 4px 0 0;
  }
  .size-option{
    width: 40px;
    height: 30px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #fff;
    font-size: 16px;
    font-weight: bold;
  }
  .size-option::-webkit-inner-spin-button,
  .size-option::-webkit-outer-spin-button {
    appearance: none;
    margin: 0;
  }

  .add-to-cart-btn {
    background-color: #ff0000;
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
  }

  .add-to-cart-btn:disabled {
    background-color: gray;
    cursor: not-allowed;
  }

  .add-to-cart-btn:hover:not(:disabled) {
    background-color: #333;
  }
</style>
